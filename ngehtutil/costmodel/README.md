# Cost Model for ngEHT Program

## To use

This repo is a module that exposes two functions that are used to calculate cost information for an array configuration:

* calculate_costs takes a cost_configuration, which specified things like size of new dishes, when construction starts, etc. It also takes a description of an array as a set of structures describing the antennas in the array. It returns a dict with a lot of cost information.
* calculate_costs_over_time takes the cost information and returns a schedule of capex and opex payments over time.

## Requirements

* Python (written under 3.9 but will probably work for earlier)

  _Note: Use of a virtual python environment (`python -m venv` _venvdir_) is **highly recommended**_
* pip
* Additional dependencies installed via `pip install -r requirements.txt` or `python -m pip install -r requirements.txt`

  _Note: On Windows, some dependencies require MS VC++ tools from
  [Visual Studio Build Tools](https://visualstudio.microsoft.com/thank-you-downloading-visual-studio/?sku=BuildTools&rel=16) be present.
  They need to be installed prior to running the command above; be sure to select C++ in the installation option)._

## Example

Cost.py is simple application to exercise the calculate_cost and calculate_cost_over_time functions.

```
usage: python cost.py [--help] [--const_file CONST_FILE] [--setup_file SETUP_FILE]
                      [--new_site_config CONFIG_COLUMN] [--array ARRAY_COLUMN]
                      [--output_file OUTPUT_FILE] [--verbose]
```

Relies on three input files:

* *CONST_FILE* contains all of the constants governing the cost calculations: information about sites, costs for construction and data, etc. The default const_constants.xlsx is provided as part of the module and shouldn't be touched unless you're really updating it. cost.py will pull in the default file if you don't specify another.
* *SETUP_FILE* contains both the array configurations to be costed (first tab) and specific lists of sites to be evaluated (second tab). Use the default as the template, and add as many configurations and arrays as desired. The default array_setup.xlsx is pulled in if you don't specify another.
* *CONFIG_COLUMN* specifies the configuration to use for new sites when calculating for different array site configurations (defaults to first column in the SETUP_FILE)
* *ARRAY_COLUMN* specified the array site configuration to use when calculating for different new site configurations (defaults to first column in the SETUP_FILE)
* *SITE_FILE* contains information about the sites - location, etc.

and

* *OUTPUT_FILE* tells the code where to dump the data. Should be a .xlsx - will use cost_output.xlsx if unspecified
  &nbsp;
  &nbsp;

## Another Example

Exercise.py takes a number of options for configuration parameters and runs the cost model against all of the permutations.

```
usage: python exercise.py
```

Records output to exercise_out.xlsx
&nbsp;
&nbsp;

## Even More Fun

Exercise_vis.py uses the exercise_out.xlsx file generated by exercise.py to provide a dynamic UI that allows changing the configuration and seeing the cost data points. It requires plotly (pip install plotly), and, if you're running on windows, may require you to enable local web serving. (Control panel -> Turn windows features on or off -> Internet Information Services -> turn on Web Management Tools and World Wide Web Serivces)

```
usage: python exercise_vis.py
```
